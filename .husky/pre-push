#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Function to start Docker
start_docker() {
  # Check the OS type
  OS="$(uname -s)"
  
  for i in {1..3}; do
    # Check if Docker is running
    if ! docker info > /dev/null 2>&1; then
      echo "Attempting to start Docker... (Attempt $i)"
      
      if [ "$OS" = "Linux" ]; then
        # Command to start Docker on Linux
        sudo systemctl start docker
      elif [ "$OS" = "Darwin" ]; then
        # Command to start Docker on macOS
        open -a Docker
      elif [[ "$OS" == *"NT"* ]]; then
        # Command to start Docker on Windows
        start /B "Docker" "C:\path\to\Docker\Docker.exe" # Update with your Docker installation path
      fi
      
      sleep 10
    else
      echo "Docker is running."
      return
    fi
  done
  echo "Failed to start Docker after 3 attempts."
  exit 1
}

# Check if Docker is running
start_docker

# Run Docker-based component tests before pushing the code
npm run docker:build:run-ct-test
